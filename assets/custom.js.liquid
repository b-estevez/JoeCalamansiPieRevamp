// global variables
const headerTag = document.querySelector('header');
const isHeroSectionExist = document.querySelector(`div[id*=__hero]`);

// Nav scroll
// Get the offset position of the navbar
var sticky = headerTag.offsetTop;
window.onscroll = function() {
    changeNav();
}

function changeNav(){
  if(isHeroSectionExist)
    if (window.pageYOffset > sticky) {
        headerTag.classList.add("bg-white","text-green-950","shadow-header");
        // Text
        document.querySelectorAll('header .text-white')?.forEach((e) => e.classList.replace('text-white','text-green-950'));  
        // Active background  
        document.querySelectorAll('header .bg-white\\/10')?.forEach((e) => e.classList.replace('bg-white/10','bg-green-950/10'));
        // Hover
        document.querySelectorAll('header .hover\\:bg-white\\/10')?.forEach((e) => e.classList.replace('hover:bg-white/10','hover:bg-green-950/10'));
        // Logo
        document.querySelector('#jcc_logo')?.classList.remove('invisible');
    } else {
        headerTag.classList.remove("bg-white","text-green-950",".shadow-header");
        // Text
        document.querySelectorAll('header .text-green-950')?.forEach((e) => e.classList.replace('text-green-950','text-white'));
        // Active background
        document.querySelectorAll('header .bg-green-950\\/10')?.forEach((e) => e.classList.replace('bg-green-950/10','bg-white/10'));
        // Hover
        document.querySelectorAll('header .hover\\:bg-green-950\\/10')?.forEach((e) => e.classList.replace('hover:bg-green-950/10','hover:bg-white/10'));
        // Logo
        document.querySelector('#jcc_logo')?.classList.add('invisible');
      
    }
}

// End of Nav scroll

// Nav changes to default color when Hero section do not exist.
if(!isHeroSectionExist){
  // Remove animations
  headerTag.classList.remove("transition", "delay-150", "duration-300", "ease-in-out");
  headerTag.classList.add("shadow-header");
  document.querySelector('#jcc_logo')?.classList.remove("transition", "duration-200", "ease-in-out");

  headerTag.classList.add("bg-white","text-green-950");
  // Text
  document.querySelectorAll('header .text-white')?.forEach((e) => e.classList.replace('text-white','text-green-950'));  
  // Active background  
  document.querySelectorAll('header .bg-white\\/10')?.forEach((e) => e.classList.replace('bg-white/10','bg-green-950/10'));
  // Hover
  document.querySelectorAll('header .hover\\:bg-white\\/10')?.forEach((e) => e.classList.replace('hover:bg-white/10','hover:bg-green-950/10'));
  // Logo
        document.querySelector('#jcc_logo')?.classList.remove('invisible');
}


// product page functions

const first_image = document.querySelector('.product-first-image');
const second_image = document.querySelector('.product-second-image');
const third_image = document.querySelector('.product-third-image');

function transition(e){
    const clickedImage = e.target;

    // If left image was clicked
    if(clickedImage.classList.contains("product-second-image")){
        // Animate first image
        first_image.classList.add("animate-productFirstImageLeftTransition");
        // Animate clicked image
        clickedImage.classList.add("animate-productSecondImageTransition");

        // Swap images & remove animation class after animation ends
        first_image.addEventListener("animationend", ()=> {
            first_image.classList.remove("animate-productFirstImageLeftTransition");
            clickedImage.classList.remove("animate-productSecondImageTransition");
            swapImage(e);            
        }, { once: true });
    }

        // If right image was clicked
    if(clickedImage.classList.contains("product-third-image")){
        // Animate first image
        first_image.classList.add("animate-productFirstImageRightTransition");
        // Animate clicked image
        clickedImage.classList.add("animate-productThirdImageTransition");
        
        // Swap images & remove animation class after animation ends
        first_image.addEventListener("animationend", ()=> {
            first_image.classList.remove("animate-productFirstImageRightTransition");
            clickedImage.classList.remove("animate-productThirdImageTransition");
            swapImage(e);            
        }, { once: true });
    }

}

function swapImage(e){
    first_image.style.backgroundImage;
    const clickedImage = e.target.style.backgroundImage;
    e.target.style.backgroundImage = first_image.style.backgroundImage;
    first_image.style.backgroundImage = clickedImage;
}

if(second_image || third_image){
  second_image.addEventListener('click', transition);
  third_image.addEventListener('click', transition);
}

// third_image.onclick = transition;

// end of product page functions



// Function to handle the toast
function autoHideToast(toastElementId, durationMilliseconds = 5000) {
  const toast = document.getElementById(toastElementId);

  // 1. Check if the element exists on the page
  if (toast) {
    // 2. Start a timer (e.g., 5000ms or 5 seconds)
    setTimeout(() => {
      // 3. Action to hide the toast
      
      // OPTION A: Hide via CSS class (Recommended for animations)
      // Add a class that sets opacity to 0 and visibility to hidden
      toast.classList.add('hidden'); 
      
      // OPTION B: Simple inline style hide (Less elegant)
      // toast.style.display = 'none'; 
      
    }, durationMilliseconds);
  }
}

// 4. Call the function when the page loads
// The toast will only be present if form.posted_successfully? was true on the server
document.addEventListener('DOMContentLoaded', () => {
  // Pass the ID of your success message element
  autoHideToast('subscribe_toast', 2000); // Hide after 6 seconds
});




// Scroll to section
document.addEventListener('DOMContentLoaded', function() {
  
  // Select all elements (including buttons) that have the data-scroll-to attribute
  const scrollButtons = document.querySelectorAll('[data-scroll-to]');
  
  scrollButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      
      // Prevent any default button action (though often unnecessary for simple buttons)
      e.preventDefault();
      
      // Get the target ID from the data-scroll-to attribute
      const targetSelector = this.dataset.scrollTo; // Same as this.getAttribute('data-scroll-to')
      
      // Find the element on the page
      const targetElement = document.querySelector(targetSelector);
      
      if (targetElement) {
        // Scroll smoothly to the target element
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start' 
        });
      }
    });
  });
});


// Hiding header when captcha shows up
if(document.querySelector('.shopify-challenge__container')){
    document.querySelector('header').classList.add('hidden');
}